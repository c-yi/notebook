# http

## 多路复用

**HTTP/2:** 复用 TCP 连接，在一个连接里，客户端和浏览器都可以同时发送多个请求或回应，而且不用按照顺序一一对应。帧里边包含流的信息,不用担心混淆  
**http/1.0:** 如需要发送多个请求必须创建多个 TCP 连接，并且浏览器对于单域名请求有数量限制（一般6个），其连接无法被复用  
**http/1.1:** 引入管道机制（pipe lining）技术，但先天 FIFO（先进先出）机制导致当前请求的执行依赖于上一个请求执行的完成，容易引起报头阻塞，并没有从根本上解决问题  
**http/2:** 重新定义底层 http 语义映射，允许同一个连接上使用请求和响应双向数据流。同一域名只需占用一个 TCP 连接，通过数据流（Stream）以帧为基本协议单位，从根本上解决了问题，避免了因频繁创建连接产生的延迟，减少了内存消耗，提升了使用性能  

## TCP三次握手和四次挥手

![握手,挥手](~@img/httpTCP.png)

> 握手

三次握手之所以是三次是保证client和server均让对方知道自己的接收和发送能力没问题而保证的最小次数。  
第一次client => server 只能server判断出client具备发送能力  
第二次 server => client client就可以判断出server具备发送和接受能力。此时client还需让server知道自己接收能力没问题于是就有了第三次   
第三次 client => server 双方均保证了自己的接收和发送能力没有问题  

其中，为了保证后续的握手是为了应答上一个握手，每次握手都会带一个标识 seq，后续的ACK都会对这个seq进行加一来进行确认。

> 挥手

TCP是全双工信道，何为全双工就是客户端与服务端建立两条通道，  
通道1:客户端的输出连接服务端的输入；  
通道2:客户端的输入连接服务端的输出。两个通道可以同时工作：客户端向服务端发送信号的同时服务端也可以向客户端发送信号。  
所以关闭双通道的时候就是这样：  
客户端：我要关闭输入通道了。 服务端：好的，你关闭吧，我这边也关闭这个通道。  
服务端：我也要关闭输入通道了。 客户端：好的你关闭吧，我也把这个通道关闭。  

