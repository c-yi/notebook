(window.webpackJsonp=window.webpackJsonp||[]).push([[159],{544:function(s,e,n){"use strict";n.r(e);var a=n(23),r=Object(a.a)({},(function(){var s=this,e=s.$createElement,n=s._self._c||e;return n("ContentSlotsDistributor",{attrs:{"slot-key":s.$parent.slotKey}},[n("h1",{attrs:{id:"浏览器运行机制"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#浏览器运行机制"}},[s._v("#")]),s._v(" 浏览器运行机制")]),s._v(" "),n("p",[s._v("执行一个宏任务（栈中没有就从事件队列中获取）")]),s._v(" "),n("p",[s._v("执行过程中如果遇到微任务，就将它添加到微任务的任务队列中")]),s._v(" "),n("p",[s._v("宏任务执行完毕后，立即执行当前微任务队列中的所有微任务（依次执行）")]),s._v(" "),n("p",[s._v("当前宏任务执行完毕，开始检查渲染，然后GUI线程接管渲染")]),s._v(" "),n("p",[s._v("渲染完毕后，JS线程继续接管，开始下一个宏任务（从事件队列中获取）")]),s._v(" "),n("div",{staticClass:"language-mermaid line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-text"}},[n("code",[s._v("graph TD\n subgraph 任务\n end\n subgraph 宏任务\n end\n subgraph 微任务\n end\n")])]),s._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[s._v("1")]),n("br"),n("span",{staticClass:"line-number"},[s._v("2")]),n("br"),n("span",{staticClass:"line-number"},[s._v("3")]),n("br"),n("span",{staticClass:"line-number"},[s._v("4")]),n("br"),n("span",{staticClass:"line-number"},[s._v("5")]),n("br"),n("span",{staticClass:"line-number"},[s._v("6")]),n("br"),n("span",{staticClass:"line-number"},[s._v("7")]),n("br")])]),n("h1",{attrs:{id:"event-loop"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#event-loop"}},[s._v("#")]),s._v(" Event Loop")]),s._v(" "),n("p",[s._v("很多人不知道的是，重绘和回流其实和 Event loop 有关。")]),s._v(" "),n("ol",[n("li",[s._v("当 Event loop 执行完 Microtasks 后，会判断 document 是否需要更新。因为浏览器是 60Hz 的刷新率，每 16ms 才会更新一次。")]),s._v(" "),n("li",[s._v("然后判断是否有 "),n("code",[s._v("resize")]),s._v(" 或者 "),n("code",[s._v("scroll")]),s._v(" ，有的话会去触发事件，所以 "),n("code",[s._v("resize")]),s._v(" 和 "),n("code",[s._v("scroll")]),s._v(" 事件也是至少 16ms 才会触发一次，并且自带节流功能。")]),s._v(" "),n("li",[s._v("判断是否触发了 media query")]),s._v(" "),n("li",[s._v("更新动画并且发送事件")]),s._v(" "),n("li",[s._v("判断是否有全屏操作事件")]),s._v(" "),n("li",[s._v("执行 "),n("code",[s._v("requestAnimationFrame")]),s._v(" 回调")]),s._v(" "),n("li",[s._v("执行 "),n("code",[s._v("IntersectionObserver")]),s._v(" 回调，该方法用于判断元素是否可见，可以用于懒加载上，但是兼容性不好")]),s._v(" "),n("li",[s._v("更新界面")]),s._v(" "),n("li",[s._v("以上就是一帧中可能会做的事情。如果在一帧中有空闲时间，就会去执行 "),n("code",[s._v("requestIdleCallback")]),s._v(" 回调。")])]),s._v(" "),n("blockquote",[n("p",[s._v("当前宏任务执行完毕,开始检查渲染,然后GUI线程接管渲染,渲染完毕后,JS线程继续接管,开始下一个宏任务(从事件队列中获取)")])]),s._v(" "),n("div",{staticClass:"language-mermaid line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-text"}},[n("code",[s._v("graph TD\n start(生成执行环境)--\x3ecreat\n creat[执行环境顺序加到执行栈中]--\x3easync/sync\n async/sync{异步/同步}==>|同步代码|sync\n async/sync--\x3e|异步代码|async\n sync[直接执行]--\x3e执行栈\n async[加到任务队列]--\x3emicro\n async--\x3emacro\n macro[宏任务]--\x3etask[task]\n micro[微任务]--\x3ejobs[jobs]\n 执行栈[任务结束]==>|查看微任务队列|jobs\n jobs--\x3e|微任务队列为空|task\n task--\x3e|执行宏任务|async/sync\n jobs--\x3e|微任务队列不为空|excuteMicro\n excuteMicro[执行微任务]--\x3e|执行微任务|async/sync\n excuteMicro--\x3emicroEnd\n microEnd[微任务队列清空后]\n\n")])]),s._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[s._v("1")]),n("br"),n("span",{staticClass:"line-number"},[s._v("2")]),n("br"),n("span",{staticClass:"line-number"},[s._v("3")]),n("br"),n("span",{staticClass:"line-number"},[s._v("4")]),n("br"),n("span",{staticClass:"line-number"},[s._v("5")]),n("br"),n("span",{staticClass:"line-number"},[s._v("6")]),n("br"),n("span",{staticClass:"line-number"},[s._v("7")]),n("br"),n("span",{staticClass:"line-number"},[s._v("8")]),n("br"),n("span",{staticClass:"line-number"},[s._v("9")]),n("br"),n("span",{staticClass:"line-number"},[s._v("10")]),n("br"),n("span",{staticClass:"line-number"},[s._v("11")]),n("br"),n("span",{staticClass:"line-number"},[s._v("12")]),n("br"),n("span",{staticClass:"line-number"},[s._v("13")]),n("br"),n("span",{staticClass:"line-number"},[s._v("14")]),n("br"),n("span",{staticClass:"line-number"},[s._v("15")]),n("br"),n("span",{staticClass:"line-number"},[s._v("16")]),n("br"),n("span",{staticClass:"line-number"},[s._v("17")]),n("br"),n("span",{staticClass:"line-number"},[s._v("18")]),n("br")])]),n("div",{staticClass:"language-mermaid line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-text"}},[n("code",[s._v("graph TD\n documentChange[更新UI?]--\x3ebroswer\n broswer[resize/scroll?]--\x3emediaQuery\n mediaQuery[媒体查询]--\x3efullScreen\n fullScreen[全屏操作事件?]--\x3e|执行requestAnimationFrame回调|requestAnimationFrame\n requestAnimationFrame[requestAnimationFrame?]--\x3e|执行IntersectionObserver回调,判断元素是否可见|IntersectionObserver\n IntersectionObserver[IntersectionObserver]--\x3erender\n render[更新界面]--\x3e|如果在一帧中有空闲时间,就会去执行|requestIdleCallback\n requestIdleCallback[requestIdleCallback]\n")])]),s._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[s._v("1")]),n("br"),n("span",{staticClass:"line-number"},[s._v("2")]),n("br"),n("span",{staticClass:"line-number"},[s._v("3")]),n("br"),n("span",{staticClass:"line-number"},[s._v("4")]),n("br"),n("span",{staticClass:"line-number"},[s._v("5")]),n("br"),n("span",{staticClass:"line-number"},[s._v("6")]),n("br"),n("span",{staticClass:"line-number"},[s._v("7")]),n("br"),n("span",{staticClass:"line-number"},[s._v("8")]),n("br"),n("span",{staticClass:"line-number"},[s._v("9")]),n("br")])])])}),[],!1,null,null,null);e.default=r.exports}}]);