(window.webpackJsonp=window.webpackJsonp||[]).push([[23],{379:function(s,t,a){s.exports=a.p+"assets/img/1581334497144.0e92c81f.png"},556:function(s,t,a){"use strict";a.r(t);var r=a(23),e=Object(r.a)({},(function(){var s=this,t=s.$createElement,r=s._self._c||t;return r("ContentSlotsDistributor",{attrs:{"slot-key":s.$parent.slotKey}},[r("h1",{attrs:{id:"镜像制作"}},[r("a",{staticClass:"header-anchor",attrs:{href:"#镜像制作"}},[s._v("#")]),s._v(" 镜像制作")]),s._v(" "),r("h2",{attrs:{id:"docker-commit"}},[r("a",{staticClass:"header-anchor",attrs:{href:"#docker-commit"}},[s._v("#")]),s._v(" docker commit")]),s._v(" "),r("h3",{attrs:{id:"镜像制作-2"}},[r("a",{staticClass:"header-anchor",attrs:{href:"#镜像制作-2"}},[s._v("#")]),s._v(" 镜像制作")]),s._v(" "),r("div",{staticClass:"language-powershell line-numbers-mode"},[r("pre",{pre:!0,attrs:{class:"language-powershell"}},[r("code",[r("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# docker commit:提交一个正在运行的容器为一个新的镜像")]),s._v("\n"),r("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 本例:制作一个 tomcat镜像,制作步骤")]),s._v("\n"),r("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 1、拉乎一个基础镜像(其始就是os)")]),s._v("\ndocker pull centos\n"),r("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 2、创建一个交互式容器")]),s._v("\ndocker run "),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("it "),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("--")]),s._v("name=mycentos centos: latest\n"),r("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 3、软件上传:将宿主机 Tomact、jdk上传到容器中")]),s._v("\ndocker "),r("span",{pre:!0,attrs:{class:"token function"}},[s._v("cp")]),s._v(" apache"),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("tomcat"),r("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("0"),r("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v(" 47"),r("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v(" tar"),r("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v(" gz mycentos: "),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),s._v("root"),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),s._v("\ndocker "),r("span",{pre:!0,attrs:{class:"token function"}},[s._v("cp")]),s._v(" jdk"),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("8u161"),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("linux"),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("x64"),r("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v(" tar"),r("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v(" gz my centos: "),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),s._v("root"),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),s._v("\n"),r("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 4、在容器中安装jdk( yum insta11java-1.7.8- openjdk)")]),s._v("\n\n"),r("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 5. 将容器制作成镜像")]),s._v("\n"),r("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# docker commit 容器名称 镜像名称")]),s._v("\n"),r("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 例如")]),s._v("\ndocker commit mycentos mytomcat\n")])]),s._v(" "),r("div",{staticClass:"line-numbers-wrapper"},[r("span",{staticClass:"line-number"},[s._v("1")]),r("br"),r("span",{staticClass:"line-number"},[s._v("2")]),r("br"),r("span",{staticClass:"line-number"},[s._v("3")]),r("br"),r("span",{staticClass:"line-number"},[s._v("4")]),r("br"),r("span",{staticClass:"line-number"},[s._v("5")]),r("br"),r("span",{staticClass:"line-number"},[s._v("6")]),r("br"),r("span",{staticClass:"line-number"},[s._v("7")]),r("br"),r("span",{staticClass:"line-number"},[s._v("8")]),r("br"),r("span",{staticClass:"line-number"},[s._v("9")]),r("br"),r("span",{staticClass:"line-number"},[s._v("10")]),r("br"),r("span",{staticClass:"line-number"},[s._v("11")]),r("br"),r("span",{staticClass:"line-number"},[s._v("12")]),r("br"),r("span",{staticClass:"line-number"},[s._v("13")]),r("br"),r("span",{staticClass:"line-number"},[s._v("14")]),r("br"),r("span",{staticClass:"line-number"},[s._v("15")]),r("br")])]),r("h3",{attrs:{id:"端口映射"}},[r("a",{staticClass:"header-anchor",attrs:{href:"#端口映射"}},[s._v("#")]),s._v(" 端口映射")]),s._v(" "),r("div",{staticClass:"language-powershell line-numbers-mode"},[r("pre",{pre:!0,attrs:{class:"language-powershell"}},[r("code",[r("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 基于上面的制作的镜像创建一个容器 将容器 8080 端口映射到 8888 接口")]),s._v("\ndocker run "),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("itd "),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("--")]),s._v("name=t1 "),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("P 8888: 8080 mytomcat "),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),s._v("bin"),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),s._v("bash\n"),r("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 启动容器")]),s._v("\ndocker exec t1 "),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),s._v("usr"),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),s._v("local"),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),s._v("apache "),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("tomcat"),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("70 47"),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),s._v("bin"),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),s._v("startup"),r("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v(" sh\n")])]),s._v(" "),r("div",{staticClass:"line-numbers-wrapper"},[r("span",{staticClass:"line-number"},[s._v("1")]),r("br"),r("span",{staticClass:"line-number"},[s._v("2")]),r("br"),r("span",{staticClass:"line-number"},[s._v("3")]),r("br"),r("span",{staticClass:"line-number"},[s._v("4")]),r("br")])]),r("h3",{attrs:{id:"容器-镜像打包"}},[r("a",{staticClass:"header-anchor",attrs:{href:"#容器-镜像打包"}},[s._v("#")]),s._v(" 容器/镜像打包")]),s._v(" "),r("div",{staticClass:"language-powershell line-numbers-mode"},[r("pre",{pre:!0,attrs:{class:"language-powershell"}},[r("code",[r("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 镜像打包:")]),s._v("\n\n"),r("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 1. 镜像打包:")]),s._v("\n   docker save "),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("o "),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),s._v("root"),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),s._v("tomcat"),r("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("tar mytomcat\n"),r("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 2. 将打包的镜像上传到其他服务器")]),s._v("\n   scp tomcat"),r("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("tar 其他服务器ip:"),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),s._v("root\n"),r("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 3. 导入镜像")]),s._v("\n   docker load "),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("i "),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),s._v("root"),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),s._v("tomcat"),r("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v(" tar\n\n"),r("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 容器打包:")]),s._v("\n\n"),r("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 1. 容器打包")]),s._v("\n   docker export "),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("o "),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),s._v("root"),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),s._v("t1"),r("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v(" tar t1\n"),r("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 2. 导入容器")]),s._v("\n   docker import t1"),r("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v(" tar mytomcat: latest\n")])]),s._v(" "),r("div",{staticClass:"line-numbers-wrapper"},[r("span",{staticClass:"line-number"},[s._v("1")]),r("br"),r("span",{staticClass:"line-number"},[s._v("2")]),r("br"),r("span",{staticClass:"line-number"},[s._v("3")]),r("br"),r("span",{staticClass:"line-number"},[s._v("4")]),r("br"),r("span",{staticClass:"line-number"},[s._v("5")]),r("br"),r("span",{staticClass:"line-number"},[s._v("6")]),r("br"),r("span",{staticClass:"line-number"},[s._v("7")]),r("br"),r("span",{staticClass:"line-number"},[s._v("8")]),r("br"),r("span",{staticClass:"line-number"},[s._v("9")]),r("br"),r("span",{staticClass:"line-number"},[s._v("10")]),r("br"),r("span",{staticClass:"line-number"},[s._v("11")]),r("br"),r("span",{staticClass:"line-number"},[s._v("12")]),r("br"),r("span",{staticClass:"line-number"},[s._v("13")]),r("br"),r("span",{staticClass:"line-number"},[s._v("14")]),r("br"),r("span",{staticClass:"line-number"},[s._v("15")]),r("br")])]),r("h2",{attrs:{id:"docker-builder"}},[r("a",{staticClass:"header-anchor",attrs:{href:"#docker-builder"}},[s._v("#")]),s._v(" docker builder")]),s._v(" "),r("blockquote",[r("p",[s._v("DSL 语法")])]),s._v(" "),r("p",[r("img",{attrs:{src:a(379),alt:"1581334497144"}})]),s._v(" "),r("h3",{attrs:{id:"指令"}},[r("a",{staticClass:"header-anchor",attrs:{href:"#指令"}},[s._v("#")]),s._v(" 指令")]),s._v(" "),r("p",[r("strong",[s._v("FROM")]),s._v(" 指定基础镜像")]),s._v(" "),r("blockquote",[r("p",[s._v("如果你以 "),r("code",[s._v("scratch")]),s._v(" 为基础镜像的话，意味着你不以任何镜像为基础，接下来所写的指令将作为镜像第一层开始存在。")]),s._v(" "),r("p",[s._v("使用 "),r("a",{attrs:{href:"https://golang.org/",target:"_blank",rel:"noopener noreferrer"}},[s._v("Go 语言"),r("OutboundLink")],1),s._v(" 开发的应用很多会使用这种方式来制作镜像，这也是为什么有人认为 Go 是特别适合容器微服务架构的语言的原因之一。")])]),s._v(" "),r("p",[r("strong",[s._v("RUN")]),s._v("  执行命令行命令")]),s._v(" "),r("blockquote",[r("ol",[r("li",[s._v("每执行一次 "),r("strong",[s._v("RUN")]),s._v(" 命令就会封装一层镜像,对于同一个目的的 run 应该合并成一个 RUN 命令,减少封装层数,达到减少体积的目的,")]),s._v(" "),r("li",[s._v("在制作完这一层镜像之后,应该只保留我们需要的东西,删除了为了编译构建所需要的软件，清理了所有下载、展开的文件，并且还清理了 "),r("code",[s._v("apt")]),s._v(" 缓存文件。")])])]),s._v(" "),r("div",{staticClass:"custom-block danger"},[r("p",{staticClass:"custom-block-title"},[s._v("注意")]),s._v(" "),r("p",[s._v("很多人初学 Docker 制作出了很臃肿的镜像的原因之一，就是忘记了每一层构建的最后一定要清理掉无关文件。")])])])}),[],!1,null,null,null);t.default=e.exports}}]);